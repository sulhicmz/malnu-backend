name: openhands

on:
  workflow_dispatch:

# Minimum required permissions for general automation
permissions:
  contents: read
  issues: write

# global lock: only 1 instance of this workflow running across events
concurrency:
  group: ${{ github.workflow }}-global
  cancel-in-progress: false

jobs:
  complex-task:
    runs-on: ubuntu-slim
    steps:
      - uses: actions/checkout@v4      
      - name: Run complex OpenHands task
        id: openhands
        uses: All-Hands-AI/openhands-github-action@v1
        with:
          prompt: |
            Please analyze the codebase and:
            1. Identify potential security vulnerabilities
            2. Suggest performance improvements
            3. Update the README with your findings
          repository: ${{ github.repository }}
          selected-branch: ${{ github.ref_name }}
          base-url: https://apis.iflow.cn/v1
          poll: "true"
          timeout-seconds: "1800"
          poll-interval-seconds: "45"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          openhands-api-key: ${{ secrets.IFLOW_API_KEY }}
      
      - name: Use outputs
        run: |
          echo "Conversation ID: ${{ steps.openhands.outputs.conversation-id }}"
          echo "Final Status: ${{ steps.openhands.outputs.status }}"
          echo "View conversation: ${{ steps.openhands.outputs.conversation-url }}"
